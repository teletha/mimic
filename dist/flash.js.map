{"version":3,"file":"flash.js","sources":["../src/flash.js"],"sourcesContent":["/*\r\n * Copyright (C) 2025 Mimic Development Team\r\n *\r\n * Licensed under the MIT License (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *          https://opensource.org/licenses/MIT\r\n */\r\n\r\n/**\r\n * Lightweight, dependency-free class that enables SPA-like page transitions.\r\n * Designed as a minimal alternative to swup.js and fully satisfies the following requirements:\r\n *\r\n * 1. Navigation management using the History API\r\n * 2. Partial replacement of <main> and <head> elements (including re-execution of scripts)\r\n * 3. Differential updates of CSS and meta tags in <head> to prevent FOUC\r\n * 4. Full scroll position restoration (back/forward support and hash-anchor support)\r\n * 5. Transition animation control via CSS class (is-leaving) with a guaranteed minimum delay\r\n * 6. Prefetching on link hover or touch\r\n */\r\nclass Flash {\r\n\tconstructor() {\r\n\t\t/**\r\n\t\t * Cache for fetched HTML strings.\r\n\t\t * The key is a “clean URL” with query parameters removed.\r\n\t\t * @type {Map<string, string>}\r\n\t\t */\r\n\t\tthis.cache = new Map();\r\n\r\n\t\t/** @type {DOMParser} Used to convert HTML strings into DOM documents */\r\n\t\tthis.parser = new DOMParser();\r\n\r\n\t\t// Disable the browser's native scroll restoration.\r\n\t\t// In async navigations, browser timing does not match rendering timing,\r\n\t\t// so scroll position must be managed manually.\r\n\t\tif (\"scrollRestoration\" in history) {\r\n\t\t\thistory.scrollRestoration = \"manual\";\r\n\r\n\t\t\t// Initialize the current history entry with scroll data\r\n\t\t\thistory.replaceState(this.data(), \"\");\r\n\t\t}\r\n\r\n\t\t// =============================================\r\n\t\t// Initialization\r\n\t\t// =============================================\r\n\r\n\t\t// Intercept link clicks\r\n\t\tdocument.addEventListener(\"click\", (e) => {\r\n\t\t\tconst link = e.target.closest(\"a\");\r\n\r\n\t\t\t// Exclude:\r\n\t\t\t// - non-anchor clicks\r\n\t\t\t// - external links\r\n\t\t\t// - target=\"_blank\"\r\n\t\t\t// - modifier-key clicks (Ctrl/Meta/Alt/Shift)\r\n\t\t\t// - links explicitly opting out via data-no-swup\r\n\t\t\tif (!link || link.origin !== location.origin || link.target || e.ctrlKey || e.metaKey || e.altKey || e.shiftKey || link.hasAttribute(\"data-no-swup\")) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// This link is a valid SPA navigation target\r\n\t\t\te.preventDefault();\r\n\r\n\t\t\tconst currentUrl = new URL(window.location.href);\r\n\t\t\tconst targetUrl = new URL(link.href);\r\n\r\n\t\t\t// If pathname and query string are identical,\r\n\t\t\t// the user is effectively navigating to the same page.\r\n\t\t\tif (currentUrl.pathname === targetUrl.pathname && currentUrl.search === targetUrl.search) {\r\n\t\t\t\t// If only the hash differs, update history and scroll accordingly\r\n\t\t\t\tif (currentUrl.hash !== targetUrl.hash) {\r\n\t\t\t\t\thistory.replaceState(this.data(), \"\", link.href);\r\n\r\n\t\t\t\t\tconst targetId = targetUrl.hash.slice(1);\r\n\t\t\t\t\tif (targetId) {\r\n\t\t\t\t\t\tdocument.getElementById(targetId)?.scrollIntoView();\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// Save the final scroll position of the current page\r\n\t\t\thistory.replaceState(this.data(), \"\");\r\n\r\n\t\t\t// Push a new history entry\r\n\t\t\t// NOTE:\r\n\t\t\t// Due to a known bug in Cloudflare Beacon, the URL object must not be used directly.\r\n\t\t\t// The URL is reconstructed manually from pathname + search + hash.\r\n\t\t\thistory.pushState(this.data(0), \"\", targetUrl.pathname + targetUrl.search + targetUrl.hash);\r\n\r\n\t\t\t// Start a new navigation (scroll restoration is null for fresh transitions)\r\n\t\t\tthis.transit(link.href, null);\r\n\t\t});\r\n\r\n\t\t// Handle browser back/forward navigation\r\n\t\twindow.addEventListener(\"popstate\", (e) => {\r\n\t\t\t// The browser has already updated the URL.\r\n\t\t\t// Only DOM rendering and scroll restoration are required.\r\n\t\t\tthis.transit(location.href, e.state?.scroll ?? 0);\r\n\t\t});\r\n\r\n\t\t// Track and persist scroll position\r\n\t\tlet timer;\r\n\t\twindow.addEventListener(\r\n\t\t\t\"scroll\",\r\n\t\t\t() => {\r\n\t\t\t\tclearTimeout(timer);\r\n\t\t\t\ttimer = setTimeout(() => {\r\n\t\t\t\t\t// Update only the state object without changing the URL\r\n\t\t\t\t\thistory.replaceState(this.data(), \"\");\r\n\t\t\t\t}, 100);\r\n\t\t\t},\r\n\t\t\t{ passive: true }\r\n\t\t);\r\n\r\n\t\t// Enable prefetching on initial DOM\r\n\t\tthis.applyPrefetch(document);\r\n\t}\r\n\r\n\t/**\r\n\t * Generate a History API state object.\r\n\t *\r\n\t * @param {number} scroll Scroll position to store\r\n\t * @return {{scroll: number}}\r\n\t */\r\n\tdata(scroll = window.scrollY) {\r\n\t\treturn { scroll };\r\n\t}\r\n\r\n\t/**\r\n\t * Main navigation workflow.\r\n\t * Handles animation → fetch → DOM update → event dispatch.\r\n\t *\r\n\t * @param {string} url URL to fetch\r\n\t * @param {number|null} scrollTo Scroll position to restore (null = new navigation)\r\n\t */\r\n\tasync transit(url, scrollTo) {\r\n\t\t// Mark the document as leaving (used by CSS animations)\r\n\t\tdocument.documentElement.classList.add(\"is-leaving\");\r\n\r\n\t\t// Ensure a minimum transition delay for visual consistency\r\n\t\tconst delay = new Promise((resolve) => setTimeout(resolve, 120));\r\n\r\n\t\ttry {\r\n\t\t\t// Run delay and fetch in parallel and wait for both\r\n\t\t\tconst [_, html] = await Promise.all([delay, this.fetchPage(url)]);\r\n\r\n\t\t\t// Apply the new DOM\r\n\t\t\tthis.render(html, scrollTo);\r\n\t\t} catch (err) {\r\n\t\t\t// On failure, abort SPA behavior and fall back to a full page load\r\n\t\t\twindow.location.href = url;\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Remove transition marker\r\n\t\tdocument.documentElement.classList.remove(\"is-leaving\");\r\n\r\n\t\t// Dispatch a custom event for external scripts (analytics, etc.)\r\n\t\tdocument.dispatchEvent(new CustomEvent(\"swup:page:view\"));\r\n\t}\r\n\r\n\t/**\r\n\t * Parse HTML and update the current DOM.\r\n\t *\r\n\t * @param {string} html Fetched HTML\r\n\t * @param {number|null} scrollTo Scroll position to restore\r\n\t */\r\n\trender(html, scrollTo) {\r\n\t\t// Parse HTML string into a document\r\n\t\tconst doc = this.parser.parseFromString(html, \"text/html\");\r\n\r\n\t\t// Update <head>\r\n\t\tthis.updateHead(doc.head);\r\n\r\n\t\t// Update <main>\r\n\t\tconst newMain = doc.querySelector(\"main\");\r\n\t\tconst currentMain = document.querySelector(\"main\");\r\n\r\n\t\tif (newMain && currentMain) {\r\n\t\t\tcurrentMain.innerHTML = newMain.innerHTML;\r\n\r\n\t\t\t// Scripts inserted via innerHTML do not execute,\r\n\t\t\t// so they must be recreated manually.\r\n\t\t\tthis.runMainScripts(currentMain);\r\n\t\t}\r\n\r\n\t\t// Scroll handling\r\n\t\tif (typeof scrollTo === \"number\") {\r\n\t\t\t// A. Back/forward navigation: restore stored scroll position\r\n\t\t\twindow.scrollTo(0, scrollTo);\r\n\t\t} else {\r\n\t\t\t// B. New navigation: handle hash anchors if present\r\n\t\t\tconst hash = window.location.hash;\r\n\t\t\tconst targetId = hash ? hash.slice(1) : null;\r\n\t\t\tconst target = targetId ? document.getElementById(targetId) : null;\r\n\r\n\t\t\tif (target) {\r\n\t\t\t\ttarget.scrollIntoView();\r\n\t\t\t} else {\r\n\t\t\t\twindow.scrollTo(0, 0);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Reapply prefetch listeners to newly inserted links\r\n\t\tthis.applyPrefetch(currentMain);\r\n\t}\r\n\r\n\t/**\r\n\t * Update the <head> element.\r\n\t * CSS and style tags are updated differentially to prevent FOUC.\r\n\t *\r\n\t * @param {HTMLHeadElement} newHead\r\n\t */\r\n\tupdateHead(newHead) {\r\n\t\t// Update document title\r\n\t\tdocument.title = newHead.querySelector(\"title\")?.innerText || \"\";\r\n\r\n\t\t// Replace all meta tags\r\n\t\tdocument.head.querySelectorAll(\"meta\").forEach((el) => el.remove());\r\n\t\tnewHead.querySelectorAll(\"meta\").forEach((el) => {\r\n\t\t\tdocument.head.appendChild(el.cloneNode(true));\r\n\t\t});\r\n\r\n\t\t// Differential update for link (CSS) and style tags\r\n\t\tconst newTags = Array.from(newHead.querySelectorAll(\"link, style\"));\r\n\t\tconst currentTags = Array.from(document.head.querySelectorAll(\"link, style\"));\r\n\r\n\t\t// Generate a comparison key\r\n\t\tconst getKey = (el) => (el.tagName === \"LINK\" ? el.href : el.textContent);\r\n\r\n\t\tnewTags.forEach((newTag) => {\r\n\t\t\tconst newKey = getKey(newTag);\r\n\t\t\tconst existing = currentTags.find((curr) => getKey(curr) === newKey);\r\n\r\n\t\t\tif (existing) {\r\n\t\t\t\t// Mark existing tag to keep\r\n\t\t\t\texisting._keep = true;\r\n\t\t\t} else {\r\n\t\t\t\t// Append new tag\r\n\t\t\t\tdocument.head.appendChild(newTag.cloneNode(true));\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// Remove obsolete tags\r\n\t\tcurrentTags.forEach((curr) => {\r\n\t\t\tif (curr._keep) {\r\n\t\t\t\tdelete curr._keep;\r\n\t\t\t} else {\r\n\t\t\t\tcurr.remove();\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// Scripts inside <head> are intentionally ignored\r\n\t\t// to avoid duplicate execution.\r\n\t}\r\n\r\n\t/**\r\n\t * Re-execute scripts inside <main>.\r\n\t * Scripts added via innerHTML are inert by specification.\r\n\t *\r\n\t * @param {HTMLElement} container\r\n\t */\r\n\trunMainScripts(container) {\r\n\t\tconst scripts = container.querySelectorAll(\"script\");\r\n\t\tscripts.forEach((oldScript) => {\r\n\t\t\tconst newScript = document.createElement(\"script\");\r\n\r\n\t\t\t// Copy attributes\r\n\t\t\tArray.from(oldScript.attributes).forEach((attr) => {\r\n\t\t\t\tnewScript.setAttribute(attr.name, attr.value);\r\n\t\t\t});\r\n\r\n\t\t\t// Copy inline code\r\n\t\t\tnewScript.textContent = oldScript.textContent;\r\n\r\n\t\t\t// Replace and execute\r\n\t\t\toldScript.parentNode.replaceChild(newScript, oldScript);\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Fetch page HTML.\r\n\t * Uses a normalized URL (without query parameters) for caching.\r\n\t *\r\n\t * @param {string} url\r\n\t */\r\n\tasync fetchPage(url) {\r\n\t\t// Normalize URL by removing query parameters\r\n\t\tconst u = new URL(url, window.location.href);\r\n\t\turl = u.origin + u.pathname;\r\n\r\n\t\t// Cache hit\r\n\t\tif (this.cache.has(url)) {\r\n\t\t\treturn this.cache.get(url);\r\n\t\t}\r\n\r\n\t\t// Fetch from network\r\n\t\tconst res = await fetch(url);\r\n\t\tif (!res.ok) throw new Error(\"Network error\");\r\n\r\n\t\tconst text = await res.text();\r\n\t\tthis.cache.set(url, text);\r\n\t\treturn text;\r\n\t}\r\n\r\n\t/**\r\n\t * Attach prefetch handlers to links.\r\n\t *\r\n\t * @param {ParentNode} root\r\n\t */\r\n\tapplyPrefetch(root) {\r\n\t\troot.querySelectorAll(\"a\").forEach((link) => {\r\n\t\t\t// Exclude external links and opt-out links\r\n\t\t\tif (link.origin !== location.origin || link.hasAttribute(\"data-no-swup\")) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\t// Prefetch once on hover or touch\r\n\t\t\tlink.addEventListener(\"mouseenter\", () => this.fetchPage(link.href), { once: true });\r\n\t\t\tlink.addEventListener(\"touchstart\", () => this.fetchPage(link.href), { once: true, passive: true });\r\n\t\t});\r\n\t}\r\n}\r\n\r\n// Instantiate and activate Flash\r\nnew Flash();\r\n\r\n/* =====================================================================\r\n   Cloudflare Beacon SPA workaround\r\n   =====================================================================\r\n\r\n   Due to Cloudflare Beacon's SPA behavior, page views originating from\r\n   the initially loaded page (\"Start\") are not always recorded.\r\n\r\n   Example sequence:\r\n     Start -> A -> B -> Start -> C -> D\r\n\r\n   In this case, page views for A and C may not be tracked.\r\n\r\n   Workaround:\r\n   - Temporarily spoof the URL before Beacon records history\r\n   - Restore the original URL afterward\r\n   - Strip spoofed suffix from outgoing Beacon payloads\r\n\r\n   WARNING:\r\n   This relies on Beacon's internal implementation and may break\r\n   in future versions.\r\n*/\r\nconst beacon = document.currentScript?.dataset.cfBeacon;\r\nif (beacon) {\r\n\tconst suffix = \"initcfb\";\r\n\tconst path = window.location.pathname;\r\n\r\n\t// Temporarily modify the URL\r\n\thistory.replaceState({}, \"\", path + suffix);\r\n\r\n\t// Patch XMLHttpRequest.send\r\n\tconst proto = XMLHttpRequest.prototype;\r\n\tconst originalSend = proto.send;\r\n\tproto.send = function (body) {\r\n\t\tif (body?.includes(suffix)) {\r\n\t\t\tsetTimeout(() => history.replaceState({}, \"\", path));\r\n\t\t\tproto.send = originalSend;\r\n\t\t\tbody = body.replaceAll(suffix, \"\");\r\n\t\t}\r\n\t\treturn originalSend.apply(this, [body]);\r\n\t};\r\n\r\n\t// Patch navigator.sendBeacon as well\r\n\tconst originalSendBeacon = navigator.sendBeacon;\r\n\tnavigator.sendBeacon = async function (url, body) {\r\n\t\tif (body instanceof Blob) {\r\n\t\t\tbody = new Blob([(await body.text()).replaceAll(suffix, \"\")], { type: body.type });\r\n\t\t}\r\n\t\treturn originalSendBeacon.apply(this, [url, body]);\r\n\t};\r\n\r\n\t// Dynamically load Cloudflare Beacon\r\n\t// - Avoids timing issues present when embedding directly in HTML\r\n\t// - Using <script> ensures correct origin and avoids intermittent CORS errors\r\n\tconst script = document.createElement(\"script\");\r\n\tscript.dataset.cfBeacon = beacon;\r\n\tscript.src = \"https://static.cloudflareinsights.com/beacon.min.js\";\r\n\tdocument.body.appendChild(script);\r\n}\r\n"],"names":["_a"],"mappings":"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"}